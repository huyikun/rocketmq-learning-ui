---
import { isChinese } from "@i18n/util";
import { useTranslations } from "@i18n/util";
import { HOT_TUTORIALDATA } from "@/constant";
import SliderCards from "./SliderCards/index.astro";
const t = useTranslations(Astro);
const ifzh = isChinese(Astro);
const itemsPerPage = 2; // 每屏显示的元素个数
let currentScreen = 0;
---

<SliderCards
  className={"hotCourse-box"}
  prevId={"prevcourse"}
  nextId={"nextcourse"}
  title={t("home.hot.tutorial.title")}
>
  <div class="hotCourse-content" id="hotCourse-content">
    {
      HOT_TUTORIALDATA.slice(
        currentScreen * itemsPerPage,
        (currentScreen + 1) * itemsPerPage
      ).map((item) => (
        <div class="item-content">
          <div class="item-content-left">
            <img src={item.img} />
          </div>
          <div class="item-content-right">
            <div class="right-title">{item.title}</div>
            <a class="arrow" target={item.target} href={item.href}/>
          </div>
        </div>
      ))
    }
  </div>
</SliderCards>

<script>
  import { HOT_TUTORIALDATA } from "@/constant";
  document.addEventListener("astro:page-load", () => {
    let currentScreen = 0;
    const itemsPerPage = 2; // 每屏显示的元素个数
    const prevBtn = document.getElementById("prevcourse");
    const nextBtn = document.getElementById("nextcourse");
    const content = document.getElementById("hotCourse-content");
    if (prevBtn) {
      function showItem(currentScreen) {
        const newData = HOT_TUTORIALDATA.slice(
          currentScreen * itemsPerPage,
          (currentScreen + 1) * itemsPerPage
        );
        content.innerHTML = "";
        newData.forEach((item, idx) => {
          const html = `<div class="item-content">
        <div class="item-content-left">
          <img src=${item.img} />
        </div>
        <div class="item-content-right">
          <div class="right-title">${item.title}</div>
          <a class="arrow" target=${item.target} href=${item.href}></a>
        </div>
      </div>`;
          content.innerHTML += html;
        });
      }

      prevBtn.addEventListener("click", () => {
        if (currentScreen > 0) {
          currentScreen--;
        } else {
          currentScreen = Math.ceil(HOT_TUTORIALDATA.length / itemsPerPage) - 1;
        }
        showItem(currentScreen);
      });
      nextBtn.addEventListener("click", () => {
        if (
          currentScreen <
          Math.ceil(HOT_TUTORIALDATA.length / itemsPerPage) - 1
        ) {
          currentScreen++;
        } else {
          currentScreen = 0;
        }
        showItem(currentScreen);
      });
    }
  });
</script>
<style is:global>
  .hotCourse-box {
    border-radius: 16px;
    opacity: 1;
    background: rgba(234, 234, 234, 0.39);
    padding: 0 24px 32px 24px;
    margin-top: 24px;

    .hotTutorial-header {
      height: 5rem;
      display: flex;
      align-items: center;
      .title {
        font-family: Source Han Sans;
        font-weight: normal;
      }
    }
    .hotCourse-content {
      display: flex;
      height: calc(100% - 5rem);
      margin-right: -1.5rem; /* 补偿右外边距的合并 */

      .item-content {
        display: flex;
        flex: 0 0 calc(50% - 1.5rem); /* 每个元素占25%的宽度并减去1rem的右外边距 */
        margin-right: 1.5rem;

        .item-content-left {
          width: 45%;
          height: 9.375rem;
          img {
            border-radius: 8px;
            width: 100%;
            height: 100%;
          }
        }

        .item-content-right {
          width: 55%;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          padding: 8px 0 8px 12px;
          .right-title {
            line-height: 1.5rem;
          }
        }
        .arrow {
          position: relative;
          display: inline-block;
          width: 100px;
          height: 20px;
          text-align: center;
        }

        .arrow::before {
          content: "";
          position: absolute;
          top: 50%;
          left: 0;
          transform: translate(0, -50%);
          width: 24px;
          height: 1px;
          background-color: #a3a6b3;
        }

        .arrow::after {
          content: "";
          position: absolute;
          top: 50%;
          left: 19px;
          transform: translate(-50%, -50%) rotate(45deg);
          width: 8px;
          height: 8px;
          border-top: 1px solid #a3a6b3;
          border-right: 1px solid #a3a6b3;
        }

        .arrow:hover::before {
          background-color: #2b3b3a;
        }
        .arrow:hover::after {
          border-color: #2b3b3a;
        }
      }
      /* 最后一个元素去除右外边距 */
      .item-content:nth-child(2n) {
        margin-right: 0;
      }
    }
  }

  @media (max-width: 50rem) {
    .hotCourse-box {
      width: 100%;
      margin-right: 0;
      .hotCourse-content {
        flex-wrap: wrap;
        .item-content {
          flex: 0 0 calc(100% - 1.5rem); /* 每个元素占100%的宽度并减去1rem的右外边距 */
        }

        .item-content:nth-child(2n + 1) {
          margin-right: 0;
          margin-bottom: 10px;
        }
      }
    }
  }
</style>
