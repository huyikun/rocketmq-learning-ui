---
import "@starlight/style/props.css";
import "@starlight/style/reset.css";
import "@starlight/style/shiki.css";
import "@starlight/style/util.css";
import "../style/global.css";
import "../style/fonts.css";
import "@starlight/style/asides.css";
import locales from "@i18n/languages";
import { useTranslations } from "@i18n/util";
import Head from "@components/starlight/Head.astro";
import HomeHeader from "@components/common/Header/index.astro";
const t = useTranslations(Astro);

export type Props = {
  title: string;
  description?: string;
  lang?: string;
  keywords?: string[] | string;
  align?: "home";
};
const { title, description, keywords, align = "home" } = Astro.props;
const headEntry = {
  data: {
    description: description,
    keywords: keywords || t("commmon.base.layout.keywords"),
    title: title,
    head: [],
  },
};

const url = new URL(Astro.url);
const base = import.meta.env.BASE_URL.replace(/\/$/, "");
const hasBase = url.pathname.startsWith(base);
if (hasBase) url.pathname = url.pathname.replace(base, "");
const [_leadingSlash, baseSegment] = url.pathname.split("/");
let lang = locales.root.lang;
if (baseSegment && baseSegment in locales) {
  lang = baseSegment;
}
Astro.props.lang = lang;
---

<html lang={Astro.props.lang} data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="data-spm" content="5176" />
    <Head entry={headEntry} />
    <meta name="generator" content={Astro.generator} />
    <meta name="robots" content="index, follow" />
    <title>{title}</title>
    <link data-rh="true" rel="icon" href="/rmq-icon.svg" />
    <meta name="baidu-site-verification" content="codeva-1bya6X4uPs" />
    <meta name="msvalidate.01" content="13E6F6553B48CE0B4EC2979BA2358815" />
    <script
      dangerouslySetInnerHTML={{
        __html: `
           var _hmt = _hmt || [];
           (function() {
             var hm = document.createElement("script");
             hm.src = "https://hm.baidu.com/hm.js?f0746b8baf7f7d9452b9d68351d83731";
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
           })();
         `,
      }}></script>
  </head>
  <body data-spm="29160081">
    <HomeHeader align={align} lang={Astro.props.lang} {...Astro.props} />
    <slot />
  </body>
</html>
